<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="GEXEJrXTMzJpse0YrTLaHZG1JjjzV8wjuvlNDFVK58w"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Continuous Ranked Probability Score (CRPS) | Morris Huang</title> <meta name="author" content="Morris Huang"> <meta name="description" content="A Note on Continuous Ranked Probability Score (CRPS)"> <meta name="keywords" content="Morris-Huang, academic-website, portfolio-website"> <style>.main-container{display:flex;justify-content:space-between;align-items:start;gap:20px}.canvas-container{flex:2;max-width:650px}#myCanvas{width:100%;height:auto}.controls-container{flex:1;display:flex;flex-direction:column;align-items:center;gap:10px}.slider-button-container{display:flex;align-items:center;gap:10px}@media(max-width:600px){.main-container{flex-direction:column;align-items:center}.slider-button-container{flex-direction:row;justify-content:center;align-items:center;gap:10px;width:100%}.canvas-container,.controls-container{flex:none;width:100%}}.slider{-webkit-appearance:none;width:60%;height:15px;background:#d3d3d3;outline:0;opacity:.7;-webkit-transition:.2s;transition:opacity .2s}.slider:hover{opacity:1}.slider::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:25px;height:25px;background:#4caf50;border-radius:50%;cursor:pointer}.slider::-moz-range-thumb{width:25px;height:25px;background:#4caf50;border-radius:50%;cursor:pointer}#bw{display:inline-block;margin-right:10px}.next-element{clear:both}.stylish-button{background-color:#4caf50;color:white;padding:8px 12px;border:0;border-radius:5px;cursor:pointer;font-size:14px;transition:all .3s;box-shadow:0 2px 5px rgba(0,0,0,0.2)}.stylish-button:hover,.stylish-button:focus{background-color:#45a049;box-shadow:0 4px 8px rgba(0,0,0,0.3)}.stylish-button:active{background-color:#3e8e41;box-shadow:0 1px 3px rgba(0,0,0,0.3)}</style> <style>.main-container2{display:flex;justify-content:space-between;align-items:start;gap:20px}.canvas-container2{flex:1;max-width:650px}#myCanvas2{width:100%;height:auto}.controls-container2{flex:2;display:flex;flex-direction:column;align-items:center;gap:10px}.stylish-button2{background-color:#8ea6de;color:white;padding:8px 12px;border:0;border-radius:5px;cursor:pointer;font-size:14px;transition:all .3s;box-shadow:0 2px 5px rgba(0,0,0,0.2)}.stylish-button2:hover,.stylish-button2:focus{background-color:#8ea6de;box-shadow:0 4px 8px rgba(0,0,0,0.3)}.stylish-button2:active{background-color:#8ea6de;box-shadow:0 1px 3px rgba(0,0,0,0.3)}.status2{font-size:16px}@media(max-width:600px){.main-container2{flex-direction:column;align-items:center}.canvas-container2,.controls-container2{flex:none;width:100%}}.combined-container{display:flex;align-items:center;gap:15px}</style> <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Shadows+Into+Light&amp;display=swap"> <link href="https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&amp;display=swap" rel="stylesheet"> <link href="https://fonts.googleapis.com/css2?family=Gloria+Hallelujah&amp;display=swap" rel="stylesheet"> <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;500;600&amp;display=swap" rel="stylesheet"> <link href="https://fonts.googleapis.com/css2?family=Newsreader:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" rel="stylesheet"> <link href="https://fonts.googleapis.com/css2?family=LXGW+WenKai+TC&amp;family=Liu+Jian+Mao+Cao&amp;family=Ma+Shan+Zheng&amp;family=Newsreader:ital,opsz,wght@0,6..72,200..800;1,6..72,200..800&amp;family=Zen+Maru+Gothic&amp;display=swap" rel="stylesheet"> <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script> <script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]]},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]},loader:{load:["[tex]/physics"]}};</script> <script>document.addEventListener("DOMContentLoaded",()=>{MathJax.typesetPromise(["#math-content"])});</script> <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> <script src="https://cdn.jsdelivr.net/npm/particles.js"></script> <script src="https://cdn.jsdelivr.net/npm/tsparticles"></script> <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/head_round.png?29a1effb0c495894dc060e6f40dad4ff"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://physics-morris.github.io/blog/2024/CRPS/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">{
      "title": "Continuous Ranked Probability Score (CRPS)",
      "description": "A Note on Continuous Ranked Probability Score (CRPS)",
      "published": "December 17, 2024",
      "authors": [
        {
          "author": "Morris Huang",
          "authorURL": "https://physics-morris.github.io",
          "affiliations": [
            {
              "name": "Physics, NTU",
              "url": ""
            }
          ]
        }
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="desc" style="font-family: 'Gloria Hallelujah', cursive;">Morris Huang</span></a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV</a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">Teaching</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Misc</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/night-sky/">Night Sky</a> <a class="dropdown-item" href="/gallery/">Gallery</a> <a class="dropdown-item" href="/piano/">Piano</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Continuous Ranked Probability Score (CRPS)</h1> <p>A Note on Continuous Ranked Probability Score (CRPS)</p> </d-title><d-byline></d-byline><d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div><a href="#what-is-continuous-ranked-probability-score-crps">What is Continuous Ranked Probability Score (CRPS) ?</a></div> <ul> <li><a href="#definition">Definition</a></li> <li><a href="#quantile-loss">Quantile Loss</a></li> <li><a href="#quantile-decomposition-of-crps">Quantile Decomposition of CRPS</a></li> </ul> </nav> </d-contents> <h2 id="what-is-continuous-ranked-probability-score-crps-">What is Continuous Ranked Probability Score (CRPS) ?</h2> <p>How to evaluate probablistic forcasting is good or not? Continuous Ranked Probability Score (CRPS) is a evaluation metrics to quantify this. <d-footnote>Gneiting, T., &amp; Raftery, A. E. (2007). Strictly proper scoring rules, prediction, and estimation. Journal of the American statistical Association, 102(477), 359-378.</d-footnote></p> <p>Below is an example of probability forcasting of airline passengers <d-footnote>Data from: https://raw.githubusercontent.com/jbrownlee/Datasets/master/airline-passengers.csv</d-footnote> where blue line is the ground truth and the red line is the forecase mean with the ribbon is various confidence interval.</p> <center> <div class="l-page"> <iframe src="/assets/plotly/airline_passengers_forecast.html" frameborder="0" scrolling="no" height="400px" width="100%" onerror="this.onerror=null;this.src='/assets/img/NTU-logo-horizontal';"> </iframe> <noscript> <img src="/assets/img/twostream/NTU-logo-horizontal.png" height="300px" width="70%"> </noscript> </div> </center> <h3 id="definition">Definition</h3> <p>The CRPS measures the difference between a predicted <strong>cumulative distribution function</strong> (CDF) \(F(x)\) and the observed value \(y\). It is defined as:</p> \[\text{CRPS}(F, y) = \int_{-\infty}^\infty \left( F(x) - \mathbb{1}(x \geq y) \right)^2 dx.\] <p>The perfect prediction is \(\mathbb{1}(x \geq y)\) where the CDF is \(1\) greater and equal to observation \(y\). The square of difference measure the closeness of prediction density to this perfect density.</p> <h3 id="quantile-loss">Quantile Loss</h3> <p>The quantile loss \(\rho_{\alpha}(u)\) at a quantile level \(\alpha \in [0, 1]\) for a deviation \(u = z - q(\alpha)\) is defined as:</p> \[\rho_{\alpha}(u) = \begin{cases} \alpha \cdot u &amp; \text{if } u \geq 0, \\ (1 - \alpha) \cdot |u| &amp; \text{if } u &lt; 0. \end{cases}\] <p>where \(z\) is the true value, \(q(\alpha)\) is the predicted quantile at level $\alpha$, and \(u = z - q(\alpha)\) is the difference between true and prediction. The intuition make sense if we want to predict 75th quantile, we will penelize \(3\) times for under-estimated than over-estimated, for more example you can refer to here <d-footnote>https://www.kaggle.com/code/vyacheslavefimov/quantile-loss-quantile-regression</d-footnote>.</p> <h3 id="quantile-decomposition-of-crps">Quantile Decomposition of CRPS</h3> <p>We can rewrite CRPS as integral over quantile loss <d-footnote>Gneiting, T., &amp; Ranjan, R. (2011). Comparing density forecasts using threshold-and quantile-weighted scoring rules. Journal of Business &amp; Economic Statistics, 29(3), 411-422.</d-footnote></p> \[\begin{align} \text{CRPS}(F, y) &amp;= \int_{-\infty}^\infty \left( F(x) - \mathbb{1}(x \geq y) \right)^2 dx \\ &amp;= \int_{0}^{1} 2 \rho_{\alpha} \left( z - q(\alpha) \right) d \alpha, \end{align}\] <p>where (2) is the quantile decomposition of the CRPS. The key step in the derivation involves performing a <strong>change of variable</strong> from \(x\) to \(\alpha\) and utilizing the relationship between the quantile function and the cumulative distribution function (CDF). Specifically, the quantile function \(q(\alpha)\) is defined as the inverse of the CDF \(F(x)\): \(\begin{align} q(\alpha) = F^{-1}(\alpha) = \inf \{ x \in \mathbb{R} \mid F(x) \geq \alpha \}. \end{align}\)</p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/2018-12-22-distill.bib"></d-bibliography><div id="giscus_thread" style="max-width: 930px; margin: 0 auto;"> <script>let giscusTheme=localStorage.getItem("theme"),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"Physics-Morris/Physics-Morris.github.io","data-repo-id":"","data-category":"Comments","data-category-id":"","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> <style>#clustrmaps-container{width:8vw;float:right;pointer-events:none}@media screen and (max-width:600px){#clustrmaps-container{width:35%;float:right}}</style> <footer class="sticky-bottom mt-5"> <div class="container"> <div id="clustrmaps-container"> <script type="text/javascript" id="clstr_globe" src="//clustrmaps.com/globe.js?d=XDvFmaRddfU91BwoWuLT6tdJsfWAV43WimAnxx0RGZ4"></script> </div> © Copyright 2025 Morris Huang. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Last updated: January 16, 2025. <br><br> <a href="https://physics-morris.github.io/" target="_blank" rel="noopener noreferrer"> <img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fmorris-huang.com&amp;count_bg=%23317773&amp;title_bg=%23F96167&amp;icon=react.svg&amp;icon_color=%23FFFFFF&amp;title=Views&amp;edge_flat=false"> </a> </div> </footer> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z9796LV2MV"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-Z9796LV2MV");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>